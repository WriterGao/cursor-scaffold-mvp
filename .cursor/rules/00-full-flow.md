# 自然语言需求全流程

当用户用自然语言描述一个需求（例如「做一个待办列表，能增删改查，要部署到网上」）时，你必须按以下**顺序**执行，不得跳过或颠倒。

## 1. 需求设计

- 先产出 **`docs/requirements.md`**。
- 内容至少包含：功能列表、用户角色、验收标准、边界条件。
- 若用户仅要求做其中某一步（如「只写需求」），可只做该步；否则必须从本步开始。

## 2. 方案设计

- 再产出 **`docs/design.md`**。
- 内容至少包含：技术选型（本项目固定为 Next.js 全栈）、目录与路由规划、数据模型、API 列表与请求/响应约定。
- **未写 requirements 与 design 前，不得大量编写业务代码。**

## 3. 代码实现

- 严格按 **`docs/design.md`** 实现：页面放在 `app/`（App Router），接口放在 `app/api/`。
- 遵守本项目 `.cursor/rules/01-nextjs.md` 的目录与接口约定。
- 新增功能必须同时编写测试（见规则 02-commit）。

## 4. 测试并通过

- 为新增或修改的功能编写 Vitest 测试（单元或组件测试）。
- 执行 **`npm run test`**，确保全部通过。
- **若测试未通过，必须修复直至通过，不得进入提交/发布步骤。**

## 5. 提交准备

- 根据改动生成符合 **Conventional Commits** 的 commit message（见 `.cursor/rules/02-commit.md`）。
- 可执行 `git add` 与 `git commit`；是否执行 `git push` 由用户决定（建议人工确认后再 push）。

## 一次对话完成全流程

若用户希望「一次对话完成从需求到可提交」，则按顺序完成：  
需求文档 → 方案文档 → 代码实现 → 测试并通过 → 生成提交信息（并可选执行 commit）。

## 自动发布模式

当用户在需求或改动描述中 **明确提出自动发布**（例如以下语句之一）：

- 「改完之后自动发布」
- 「自动发布到线上」
- 「做完这次改动后帮我直接发布」

你必须在同一会话中按以下流程自动完成从开发到发布：

1. 严格执行本文件中的 1–4 步（需求文档 → 方案设计 → 代码实现 → 测试并通过）。
2. 在 **Node.js ≥ 20.9.0** 环境下执行 `npm run build`，确保构建成功；若失败，必须先修复再重试，直到通过。
3. 根据 `.cursor/rules/02-commit.md` 生成 Conventional Commits 消息，执行 `git add` 与 `git commit`。
4. 在所有检查通过后自动执行 `git push origin main`，由 Netlify 负责自动部署。

若在测试或构建阶段失败，**不得 push**，必须先修复代码和/或测试，直至 `npm run test` 与 `npm run build` 均通过，再执行提交和 push。
